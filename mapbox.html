<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Mapbox demo</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        .legend {
    background-color: rgba(255, 255, 255, 0.8);
    padding: 10px;
    border-radius: 5px;
    position: absolute;
    bottom: 30px;
    left: 10px;
    z-index: 10;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    width: 200px;
}

.legend h4 {
    margin: 0 0 10px 0;
}

.legend img {
    vertical-align: middle;
}

.legend span {
    vertical-align: middle;
    margin-left: 10px;
}

    </style>
</head>

<body>
    <div id='map'></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibHBlaTc1NiIsImEiOiJjbGxoOHozODAwOHpxM2xsd2ZsM2xzOWl3In0.Gh9K818BkemD9i3PrQblrQ';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [172.6362, -43.5321],
            zoom: 8
        });

        map.on('load', function () {
            // Load the icons to the map
            map.loadImage('assets/Repair.png', function (error, image) {
                if (error) throw error;
                map.addImage('repair-icon', image);
            });
            map.loadImage('assets/Maintain.png', function (error, image) {
                if (error) throw error;
                map.addImage('maintain-icon', image);
            });
            map.loadImage('assets/Build.png', function (error, image) {
                if (error) throw error;
                map.addImage('build-icon', image);
            });

            // Fetch data from both GeoJSON files
            Promise.all([
                fetch('DP_Scheduled_Activity_(OpenData).geojson').then(response => response.json()),
                fetch('DP_Outline_Development_(OpenData).geojson').then(response => response.json())
            ]).then(([scheduledActivityData, outlineDevelopmentData]) => {

                // Add the Scheduled Activity GeoJSON data source to the map
                map.addSource('scheduled-activities', {
                    type: 'geojson',
                    data: scheduledActivityData
                });

                // Add the Outline Development GeoJSON data source to the map
                map.addSource('outline-developments', {
                    type: 'geojson',
                    data: outlineDevelopmentData
                });

                // Add Scheduled Activity layer to the map
                map.addLayer({
                    'id': 'activities-icons',
                    'type': 'symbol',
                    'source': 'scheduled-activities',
                    'layout': {
                        'icon-image': [
                            'match',
                            ['get', 'LegalStatus'],
                            'Operative', 'repair-icon',
                            ''   // default
                        ],
                        'icon-size': 0.1
                    }
                });

                // Add Outline Development icons layer to the map
                map.addLayer({
                    'id': 'outline-development-icons',
                    'type': 'symbol',
                    'source': 'outline-developments',
                    'layout': {
                        'icon-image': [
                            'match',
                            ['get', 'LegalStatus'],
                            'Operative', 'build-icon',
                            ''   // default
                        ],
                        'icon-size': 0.12
                    }
                });

                // Display a popup on click for Scheduled Activities
                map.on('click', 'activities-icons', function (e) {
                    var feature = e.features[0];
                    var popup = new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML('<strong>' + feature.properties.ActivityName + '</strong><br>' +
                            'Type: ' + feature.properties.Type + '<br>' +
                            'Activity Number: ' + feature.properties.ActivityNumber + '<br>' +
                            'Legal Status: ' + feature.properties.LegalStatus)
                        .addTo(map);
                });

                // Display a popup on click for Outline Developments (assuming similar property structure)
                map.on('click', 'outline-development-icons', function (e) {
                    var feature = e.features[0];
                    var popup = new mapboxgl.Popup()
                        .setLngLat(e.lngLat)
                        .setHTML('<strong>' + feature.properties.Name + '</strong><br>' +
                            'Type: ' + feature.properties.Type + '<br>' +
                            'DPOutlineDevelopmentID: ' + feature.properties.DPOutlineDevelopmentID + '<br>' +
                            'Legal Status: ' + feature.properties.LegalStatus)
                        .addTo(map);
                });


                

            });
            
        });
        
    </script>

// add legend
<div class="legend">
    <h4>LEGEND</h4>
    <div>
        <img src="assets/Build.png" alt="Repair" width="20px">
            <span>Under Building</span>
    </div>
    <div>
        <img src="assets/Repair.png" alt="Repair" width="20px">
            <span>Under Repairing</span>
    </div>
    <div>
        <img src="assets/Maintain.png" alt="Maintain" width="20px">
            <span>Under Maintaining</span>
    </div>
</div>
</body>

</html>